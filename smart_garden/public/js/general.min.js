import{initializeApp as e}from"https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";import{getAnalytics as t}from"https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";import{getDatabase as a,ref as l,onValue as i,onChildAdded as n}from"https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";let config={apiKey:"AIzaSyCl0oQYGEespQiaLH27oRTVIc58Rxln03s",authDomain:"smart-garden-tekkom.firebaseapp.com",databaseURL:"https://smart-garden-tekkom-default-rtdb.asia-southeast1.firebasedatabase.app/",projectId:"smart-garden-tekkom",storageBucket:"smart-garden-tekkom.appspot.com",messagingSenderId:"416635037179",appId:"1:416635037179:web:0f30be292d0ca12bf8175e",measurementId:"G-VHNYTRQPZF"},app=e(config),db=a(app),datas=l(db,"/sensor");t(app);var temperature=23.4;let availableUnit=[{type:"C",value:"\xbaC",calculate:e=>e},{type:"I",value:"\xbaF",calculate:e=>1.8*e+32},{type:"SI",value:"\xbaK",calculate:e=>e+273.15},{type:"R",value:"\xbaR",calculate:e=>.8*e}],defaultUnit=0,unitTypes=availableUnit.map(e=>e.type);i(l(db,"/pump_status"),e=>{let t=e.val();$("#pump").html(t?"Hidup ":"Mati")}),n(datas,e=>{let t=e.val();$("#pressure").html(t.press??"N/A"),$("#humid").html(t.air_humadity??"N/A"),$("#soil").html(t.soil_humadity??"N/A"),$("#daw_point").html(t.daw_point??"N/A"),$("#heat_index").html(t.head_index??"N/A"),temperature=parseFloat(t.temperature),fillDataValue(),clock(t.timestamp)},console.error("Gagal mengambil data")),$("#unit-change").on("click",e=>{e.preventDefault(),fillDataValue(!0)});let getNextUnit=e=>e<unitTypes.length?e:0,fillDataValue=(e=!1)=>{let t=localStorage.getItem("uniType")??availableUnit[0].type,a=unitTypes.indexOf(t);updateUnit(getNextUnit(a=-1===a?0:e?a+=1:a))},updateUnit=e=>{localStorage.setItem("uniType",availableUnit[e].type);let t=availableUnit[e].calculate(temperature),a=availableUnit[e].value,l=availableUnit[e=getNextUnit(e+=1)].value;$("#temp-unit").html(a),$("#unit-change").html(`Change to ${l}`);let i=Math.floor(t),n=addZeroPoint(Math.floor((t-i)*100));$("#temp").html(i??"N/A"),$("#point").html(("."+n)??"00")},addZeroPoint=e=>e<10?"0"+e:e,generateCSV=(e,t)=>{var a;let l=t?["Time,Kelembapan Tanah, Kelembapan Udara"]:["Time,Temperature,Daw Point,Heat Index"];return e.forEach(e=>{a++;let i=e.val();t?l.push(`${i.timestamp},${i.soil_humadity},${i.air_humadity}`):l.push(`${i.timestamp},${i.temperature},${i.daw_point},${i.head_index}`)}),l.join(`
`)},newDate=e=>new Date(1e3*parseInt(e)),changeClockFormat=e=>{let t=newDate(e),a=t.getFullYear(),l=addZeroPoint(t.getMonth()),i=addZeroPoint(t.getDate()),n=addZeroPoint(t.getHours()),r=addZeroPoint(t.getMinutes()),m=addZeroPoint(t.getSeconds());return`${a}-${l}-${i} ${n}:${r}:${m}`};i(datas,e=>{new Dygraph(document.getElementById("chart"),generateCSV(e),{title:"Temperature History",ylabel:"Temperature (C)"}),new Dygraph(document.getElementById("humChart"),generateCSV(e,!0),{title:"Humidity History",ylabel:"%"})});let clock=e=>{let t=newDate(e);parseInt(t.toLocaleString("id-ID",{hour:"numeric",timeZone:"Asia/Jakarta"}));let a=["day","night"];$("#type").removeClass(a[1]).addClass(a[0]),$("#time").html(t.toLocaleString("en-GB",{timeZone:"UTC",timeStyle:"long",dateStyle:"long"})),$("#local-time").html(t.toLocaleString("id-ID",{timeZone:"Asia/Jakarta",timeStyle:"long",dateStyle:"long"}))};